<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detalle de Cotizaci√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f7f7;
      padding: 20px;
    }
    h1 {
      color: #02535a;
      text-align: center;
    }
    h2 {
      background-color: #02535a;
      color: white;
      padding: 10px;
      border-radius: 5px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    section {
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
#btn-guardar {
  background-color: #02535a; 
  color: white;
  font-weight: bold;
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s ease;
    }
#btn-restablecerDatosDelTour {
  background-color: #02535a; 
  color: white;
  font-weight: bold;
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s ease;
}

body, input, textarea, select, button {
  font-family: 'Segoe UI', sans-serif;
  font-size: 15px;
}
<script>
function ajustarAlturaTextareas() {
  document.querySelectorAll("textarea").forEach(textarea => {
    const ajustar = () => {
      textarea.style.height = "auto";
      textarea.style.height = textarea.scrollHeight + "px";
    };
    ajustar(); // al cargar
    textarea.addEventListener("input", ajustar); // al escribir
  });
}

window.addEventListener("DOMContentLoaded", () => {
  ajustarAlturaTextareas(); // se ejecuta despu√©s de que se renderiza todo
});
</script>
  </style>
</head>
<body>
  <h1 id="titulo-cotizacion">Detalle de Cotizaci√≥n</h1>

  <section>
    <h2>Informaci√≥n de la Solicitud</h2>
    <label>Tel√©fono</label>
    <input id="telefono" ></textarea>

    <label>Destino</label>
    <select id="destino" onchange="cargarDatosDelTour()"></select>

    <label>Fechas del viaje</label>
    <input id="fechas" />

    <label>Adultos</label>
    <input id="adultos" type="number" />

    <label>Ni√±os</label>
    <input id="ninos" type="number" />

    <label>Beb√©s</label>
    <input id="bebes" type="number" />

    <label>Observaciones</label>
    <textarea id="observaciones"></textarea>
  </section>

  <section>
    <h2>Informaci√≥n del Tour</h2>
    <label>Duraci√≥n</label>
    <input id="duracion" ></textarea>

    <label>Incluye</label>
    <textarea id="incluye" ></textarea>

    <label>No incluye</label>
    <textarea id="no_incluye" ></textarea>

    <label>Itinerario</label>
    <textarea id="itinerario" ></textarea>
  </section>
<section>
  <h2>Vuelo y Hotel</h2>
  <label>Aerol√≠nea</label>
  <select id="aerolinea">
    <option value="">-- Seleccione una aerol√≠nea --</option>
    <option value="Avianca">Avianca</option>
    <option value="Copa Airlines">Copa Airlines</option>
    <option value="Volaris">Volaris</option>
    <option value="Wingo">Wingo</option>
  </select>

  <label>Vuelo de Ida</label>
  <textarea id="vuelo_ida"></textarea>

  <label>Vuelo de Regreso</label>
  <textarea id="vuelo_vuelta"></textarea>

  <label>Equipaje</label>
  <label>Tipo de Equipaje</label>
  <select id="tipo_equipaje">
    <option value="">-- Seleccionar --</option>
    <option value="Art√≠culo personal">Art√≠culo personal (bolso de espalda)</option>
    <option value="Maleta de mano">Maleta de mano 10kg</option>
    <option value="Maleta documentada">Maleta documentada 23kg</option>
  </select>

  <label>Cantidad</label>
  <input type="number" id="cantidad_equipaje" placeholder="Ej. 2" min="1" />

  <label>Uso</label>
  <select id="uso_equipaje">
    <option value="">-- Seleccionar --</option>
    <option value="por persona">Por persona</option>
    <option value="compartido">Compartido</option>
  </select>

  <button type="button" onclick="agregarEquipaje()" style="margin-top:10px; background-color:#02535a; color:white; padding:8px 16px; border:none; border-radius:5px;">‚ûï Agregar equipaje</button>

  <label style="margin-top: 15px;">Resumen de Equipaje</label>
  <textarea id="equipaje" readonly rows="5" placeholder="Aqu√≠ aparecer√°n los tipos de equipaje agregados."></textarea>

  <label>Hotel</label>
  <select id="hotel"></select>

  <label>Informaci√≥n del Hotel</label>
  <textarea id="info_hotel"></textarea>
</section>

<section>
  <h2>Inversi√≥n por Viajero</h2>
<p style="font-style: italic; color: #555;">Todos los precios est√°n expresados en d√≥lares estadounidenses $ (USD)</p>
<label>Precio por Adulto</label>
<input type="number" id="precio_adulto" step="0.01" oninput="calcularTotal()" />

<label>Precio por Ni√±o</label>
<input type="number" id="precio_nino" step="0.01" oninput="calcularTotal()" />

<label>Precio por Beb√©</label>
<input type="number" id="precio_bebe" step="0.01" oninput="calcularTotal()" />

<label>Total General</label>
<input type="number" id="total_general" step="0.01" readonly />

<label>Monto de Reserva por Persona</label>
<input type="number" id="monto_reserva" step="0.01" />
</section>

<section>
  <h2>Tours Opcionales</h2>
  <div id="contenedor_tours_opcionales"></div>
</section>

<section>
  <h2>Pol√≠ticas y Condiciones Generales</h2>
  <textarea id="politicas"></textarea>
</section>

<!-- Agrega bot√≥n de guardar si a√∫n no lo tienes -->
<div id="mensaje-restablecer" style="display:none; padding:10px; margin-top:10px; border-radius:5px; background:#d4edda; color:#155724; font-weight:bold;">
  ‚úÖ Informaci√≥n del tour restablecida correctamente.
</div>
<button onclick="guardarCotizacion()" id="btn-guardar">üíæ Guardar Cotizaci√≥n</button>
<button type="button" onclick="restablecerDatosDelTour()" id="btn-restablecerDatosDelTour">üîÑ Restablecer informaci√≥n del tour</button>
<button onclick="generarPDF()" id="btn-generar-pdf" style="margin-left: 10px; background-color: #02535a; color: white; font-weight: bold; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer;">
  üìÑ Generar PDF
</button>

</button>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>

  const firebaseConfig = {
    apiKey: "AIzaSyDUEZgkW-3HbZu2BLej4v0mbDHZf2vRo8",
    authDomain: "tours-460717.firebaseapp.com",
    projectId: "tours-460717"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let cargadoDesdeFormal = false;
let hotelGuardado = null;
  const params = new URLSearchParams(window.location.search);
  const codigo = params.get("codigo");

  document.getElementById("titulo-cotizacion").textContent = `Detalle de Cotizaci√≥n ${codigo}`;

  async function cargarDatosIniciales() {
  await cargarOpcionesDeDestino();

  const docFormal = await db.collection("cotizacionformal").doc(codigo).get();
  const docSolicitud = await db.collection("solicitud_cotizaciones").doc(codigo).get();

  if (!docSolicitud.exists) {
    return alert("‚ùå No se encontr√≥ la solicitud de cotizaci√≥n.");
  }

 if (docFormal.exists) {
  cargadoDesdeFormal = true;
  console.log("‚úÖ Cargando desde cotizacionformal", docFormal.data());
  rellenarCampos(docFormal.data()); // ya incluye hotel, pol√≠tica, etc.
  ajustarAlturaTextareas();
} else {
  rellenarCampos(docSolicitud.data()); // si no hay cotizaci√≥n formal, se rellena base
  cargarDatosDelTour(); // ahora s√≠, se jala desde el cat√°logo (por defecto)
}
}

async function cargarOpcionesDeDestino() {
    const destinosSnap = await db.collection("tours").get();
    const select = document.getElementById("destino");
    select.innerHTML = "<option value=''>-- Seleccione un destino --</option>";
    destinosSnap.forEach(doc => {
      const opt = document.createElement("option");
      opt.value = doc.data().nombre;
      opt.textContent = doc.data().nombre;
      select.appendChild(opt);
  });
  }
  async function cargarDatosDelTour() {
    const destino = document.getElementById("destino").value;
if (!destino) return;

    const snap = await db.collection("tours").where("nombre", "==", destino).get();
    if (snap.empty) return;

    const data = snap.docs[0].data();
    document.getElementById("duracion").value = data.duracion || "";
    document.getElementById("incluye").value = data.incluye || "";
    document.getElementById("no_incluye").value = data.no_incluye || "";
    document.getElementById("itinerario").value = data.itinerario_tours || "";
console.log("Tours opcionales desde cat√°logo de tours:", data.tours_opcionales);
if (Array.isArray(data.tours_opcionales)) {
  const contenedor = document.getElementById("contenedor_tours_opcionales");
  contenedor.innerHTML = `
    <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
      <thead>
        <tr style="background-color:#02535a; color:white;">
          <th style="padding: 8px; border: 1px solid #ccc;">Tour Opcional</th>
          <th style="padding: 8px; border: 1px solid #ccc;">Descripci√≥n</th>
          <th style="padding: 8px; border: 1px solid #ccc;">Precio ($)</th>
        </tr>
      </thead>
      <tbody>
        ${data.tours_opcionales.map(tour => `
          <tr>
            <td style="padding: 8px; border: 1px solid #ccc;">${tour.nombre}</td>
            <td style="padding: 8px; border: 1px solid #ccc;">${tour.descripcion}</td>
            <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${tour.precio}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
} else {
  document.getElementById("contenedor_tours_opcionales").innerHTML = `<p style="color:#999">No hay tours opcionales disponibles.</p>`;
}
document.getElementById("politicas").value = data.politicas || "";

const hotelSelect = document.getElementById("hotel");
    hotelSelect.innerHTML = "<option value=''>-- Seleccione un hotel --</option>";
   const hoteles = Object.values(data.hoteles || {});
    hoteles.forEach(h => {
      const opt = document.createElement("option");
      opt.value = h.nombre;
      opt.textContent = h.nombre;
      hotelSelect.appendChild(opt);
    });
    hotelSelect.onchange = () => {
      const seleccionado = hoteles.find(h => h.nombre === hotelSelect.value);
      document.getElementById("info_hotel").value = seleccionado?.info || "";
}
    if (data.hotel) {
  hotelSelect.value = data.hotel;
  const seleccionado = hoteles.find(h => h.nombre === data.hotel);
  document.getElementById("info_hotel").value = seleccionado?.info || "";
};
  }
function ajustarAlturaTextareas() {
  document.querySelectorAll("textarea").forEach(textarea => {
    textarea.style.height = "auto";
    textarea.style.height = textarea.scrollHeight + "px";
  });
}
function rellenarCampos(data) {
   for (const key in data) {
  const campo = document.getElementById(key);
  if (campo) {
    campo.value = data[key];
    console.log(`üñãÔ∏è Campo ${key} actualizado con`, data[key]);
mostrarToursOpcionalesGuardados(data);
  }
}
function mostrarToursOpcionalesGuardados(data) {
  const contenedor = document.getElementById("contenedor_tours_opcionales");

  if (Array.isArray(data.tours_opcionales) && data.tours_opcionales.length > 0) {
    contenedor.innerHTML = `
      <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
          <tr style="background-color:#02535a; color:white;">
            <th style="padding: 8px; border: 1px solid #ccc;">Tour Opcional</th>
            <th style="padding: 8px; border: 1px solid #ccc;">Descripci√≥n</th>
            <th style="padding: 8px; border: 1px solid #ccc;">Precio ($)</th>
          </tr>
        </thead>
        <tbody>
          ${data.tours_opcionales.map(tour => `
            <tr>
              <td style="padding: 8px; border: 1px solid #ccc;">${tour.nombre}</td>
              <td style="padding: 8px; border: 1px solid #ccc;">${tour.descripcion}</td>
              <td style="padding: 8px; border: 1px solid #ccc; text-align: center;">${tour.precio}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
  } else {
    contenedor.innerHTML = `<p style="color:#999">No hay tours opcionales disponibles.</p>`;
  }
}
 if (data.hotel) {
    hotelGuardado = {
      nombre: data.hotel,
      info: data.info_hotel || ""
    };

    const hotelSelect = document.getElementById("hotel");
    hotelSelect.innerHTML = `<option value="${hotelGuardado.nombre}">${hotelGuardado.nombre}</option>`;
    hotelSelect.value = hotelGuardado.nombre;

    document.getElementById("info_hotel").value = hotelGuardado.info;
  }

ajustarAlturaTextareas();
}

  function calcularTotal() {
    const a = parseFloat(document.getElementById("precio_adulto").value) || 0;
    const n = parseFloat(document.getElementById("precio_nino").value) || 0;
    const b = parseFloat(document.getElementById("precio_bebe").value) || 0;
    const ca = parseInt(document.getElementById("adultos").value) || 0;
    const cn = parseInt(document.getElementById("ninos").value) || 0;
    const cb = parseInt(document.getElementById("bebes").value) || 0;
    document.getElementById("total_general").value = (a * ca + n * cn + b * cb).toFixed(2);
  }

 async function guardarCotizacion() {
  const data = {
tours_opcionales: obtenerToursOpcionalesDesdeDOM(),
    telefono: document.getElementById("telefono").value,
    destino: document.getElementById("destino").value,
    fechas: document.getElementById("fechas").value,
    adultos: parseInt(document.getElementById("adultos").value) || 0,
    ninos: parseInt(document.getElementById("ninos").value) || 0,
    bebes: parseInt(document.getElementById("bebes").value) || 0,
    observaciones: document.getElementById("observaciones").value,

    duracion: document.getElementById("duracion").value,
    incluye: document.getElementById("incluye").value,
    no_incluye: document.getElementById("no_incluye").value,
    itinerario: document.getElementById("itinerario").value, // ‚úÖ nombre corregido

    aerolinea: document.getElementById("aerolinea").value,
    vuelo_ida: document.getElementById("vuelo_ida").value,
    vuelo_vuelta: document.getElementById("vuelo_vuelta").value,
    equipaje: document.getElementById("equipaje").value,
    hotel: document.getElementById("hotel").value,
    info_hotel: document.getElementById("info_hotel").value,

    precio_adulto: parseFloat(document.getElementById("precio_adulto").value) || 0,
    precio_nino: parseFloat(document.getElementById("precio_nino").value) || 0,
    precio_bebe: parseFloat(document.getElementById("precio_bebe").value) || 0,
    total_general: parseFloat(document.getElementById("total_general").value) || 0,
    monto_reserva: parseFloat(document.getElementById("monto_reserva").value) || 0,
    politicas: document.getElementById("politicas").value,
    timestamp: new Date()
  };
function obtenerToursOpcionalesDesdeDOM() {
  const tabla = document.querySelector("#contenedor_tours_opcionales table tbody");
  if (!tabla) return [];

  const filas = tabla.querySelectorAll("tr");
  const tours = [];

  filas.forEach(fila => {
    const columnas = fila.querySelectorAll("td");
    if (columnas.length === 3) {
      const nombre = columnas[0].textContent.trim();
      const descripcion = columnas[1].textContent.trim();
      const precio = parseFloat(columnas[2].textContent.trim().replace("$", "")) || 0;
      tours.push({ nombre, descripcion, precio });
    }
  });

  return tours;
}
  try {
    await db.collection("cotizacionformal").doc(codigo).set(data, { merge: true });
    alert("‚úÖ Cotizaci√≥n guardada correctamente.");
  } catch (err) {
    console.error("‚ùå Error al guardar:", err);
    alert("‚ùå No se pudo guardar.");
  }
}
function agregarEquipaje() {
  const tipo = document.getElementById("tipo_equipaje").value;
  const cantidad = document.getElementById("cantidad_equipaje").value;
  const uso = document.getElementById("uso_equipaje").value;
  const textarea = document.getElementById("equipaje");

  if (!tipo || !cantidad || !uso) {
    alert("Por favor completa los tres campos antes de agregar el equipaje.");
    return;
  }

  const linea = `${cantidad} ${tipo.toLowerCase()}(s) ${uso}`;
  textarea.value += (textarea.value ? '\n' : '') + linea;

  // Limpiar campos
  document.getElementById("tipo_equipaje").value = "";
  document.getElementById("cantidad_equipaje").value = "";
  document.getElementById("uso_equipaje").value = "";
}

function restablecerDatosDelTour() {
  const confirmacion = confirm("¬øDeseas restablecer toda la informaci√≥n del tour desde el cat√°logo?");
  if (!confirmacion) return;

  cargarDatosDelTour();

  document.getElementById("aerolinea").value = "";
  document.getElementById("vuelo_ida").value = "";
  document.getElementById("vuelo_vuelta").value = "";
  document.getElementById("tipo_equipaje").value = "";
  document.getElementById("cantidad_equipaje").value = "";
  document.getElementById("uso_equipaje").value = "";
  document.getElementById("equipaje").value = "";

  document.getElementById("precio_adulto").value = "";
  document.getElementById("precio_nino").value = "";
  document.getElementById("precio_bebe").value = "";
  document.getElementById("total_general").value = "";
  document.getElementById("monto_reserva").value = "";

  const mensaje = document.getElementById("mensaje-restablecer");
  if (mensaje) {
    mensaje.style.display = "block";
    setTimeout(() => {
      mensaje.style.display = "none";
    }, 4000);
  }

  alert("‚úÖ Informaci√≥n del tour restablecida correctamente.");
}
  async function generarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'letter' });

  if (typeof doc.autoTable !== 'function') {
    alert("‚ùå Error: autoTable no est√° disponible.");
    return;
  }

  const data = {
    telefono: document.getElementById("telefono").value,
    destino: document.getElementById("destino").value,
    fechas: document.getElementById("fechas").value,
    adultos: document.getElementById("adultos").value,
    ninos: document.getElementById("ninos").value,
    bebes: document.getElementById("bebes").value,
    duracion: document.getElementById("duracion").value,
    incluye: document.getElementById("incluye").value,
    no_incluye: document.getElementById("no_incluye").value,
    itinerario: document.getElementById("itinerario").value,
    aerolinea: document.getElementById("aerolinea").value,
    vuelo_ida: document.getElementById("vuelo_ida").value,
    vuelo_vuelta: document.getElementById("vuelo_vuelta").value,
    equipaje: document.getElementById("equipaje").value,
    hotel: document.getElementById("hotel").value,
    info_hotel: document.getElementById("info_hotel").value,
    precio_adulto: document.getElementById("precio_adulto").value,
    precio_nino: document.getElementById("precio_nino").value,
    precio_bebe: document.getElementById("precio_bebe").value,
    total_general: document.getElementById("total_general").value,
    monto_reserva: document.getElementById("monto_reserva").value,
    politicas: document.getElementById("politicas").value,
  };

  let y = 40;
  const margenX = 40;
  const espacioVertical = 16;

  const agregarLinea = (label, value) => {
    if (value && value !== "0") {
      if (y > 720) { doc.addPage(); y = 40; }
      doc.setFont("helvetica", "normal");
      doc.setFontSize(12);
      doc.text(`${label}: ${value}`, margenX, y);
      y += espacioVertical;
    }
  };
    // Rutas o base64 de tus im√°genes de fondo
    const portada = 'ruta_o_base64_de_la_imagen_1.png';
    const fondoContenido = 'ruta_o_base64_de_la_imagen_2.png';
    const cierre = 'ruta_o_base64_de_la_imagen_3.png';

    // P√°gina 1 - Portada
    doc.addImage(portada, 'PNG', 0, 0, width, height);
    doc.setTextColor(255, 255, 255);
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(24);
    doc.text('COT-003-2025', width / 2, 140, { align: 'center' });
    doc.setFontSize(18);
    doc.text('SUPER PROMOCI√ìN MEDELL√çN', width / 2, 155, { align: 'center' });

    // P√°gina 2 - Contenido real (html)
    doc.addPage();
    doc.addImage(fondoContenido, 'PNG', 0, 0, width, height);

    // Esperar a que el HTML se renderice
    const htmlContent = document.getElementById('contenidoCotizacion');

    await html2canvas(htmlContent, {
      backgroundColor: null,
      scale: 2
    }).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      const imgProps = doc.getImageProperties(imgData);
      const ratio = width / imgProps.width;
      const canvasHeight = imgProps.height * ratio;
      doc.addImage(imgData, 'PNG', 10, 20, width - 20, canvasHeight);
    });

    // P√°gina 3 - Cierre
    doc.addPage();
    doc.addImage(cierre, 'PNG', 0, 0, width, height);
}
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.text("Detalle de Cotizaci√≥n", doc.internal.pageSize.getWidth() / 2, y, { align: "center" });
  y += 30;

  // Datos iniciales
  agregarLinea("Tel√©fono", data.telefono);
  agregarLinea("Destino", data.destino);
  agregarLinea("Fechas", data.fechas);
  agregarLinea("Adultos", data.adultos);
  agregarLinea("Ni√±os", data.ninos);
  agregarLinea("Beb√©s", data.bebes);
  agregarLinea("Duraci√≥n", data.duracion);

  // Incluye
  if (data.incluye && data.incluye.trim() !== "") {
    doc.setFont("helvetica", "bold");
    doc.text("Incluye:", margenX, y); y += 14;
    doc.setFont("helvetica", "normal");
    const lines = doc.splitTextToSize(data.incluye, 520);
    if (y + lines.length * 14 > 750) { doc.addPage(); y = 40; }
    doc.text(lines, margenX + 10, y);
    y += lines.length * 14 + 10;
  }

  // No Incluye
  if (data.no_incluye && data.no_incluye.trim() !== "") {
    doc.setFont("helvetica", "bold");
    doc.text("No Incluye:", margenX, y); y += 14;
    doc.setFont("helvetica", "normal");
    const lines = doc.splitTextToSize(data.no_incluye, 520);
    if (y + lines.length * 14 > 750) { doc.addPage(); y = 40; }
    doc.text(lines, margenX + 10, y);
    y += lines.length * 14 + 10;
  }

  // Itinerario
  if (data.itinerario && data.itinerario.trim() !== "") {
    doc.setFont("helvetica", "bold");
    doc.text("Itinerario de Tours:", margenX, y); y += 14;
    doc.setFont("helvetica", "normal");
    const lines = doc.splitTextToSize(data.itinerario, 520);
    if (y + lines.length * 14 > 750) { doc.addPage(); y = 40; }
    doc.text(lines, margenX + 10, y);
    y += lines.length * 14 + 10;
  }

  // Vuelo
  doc.setFont("helvetica", "bold");
  doc.text("Informaci√≥n del Vuelo", margenX, y); y += 14;
  doc.setFont("helvetica", "normal");
  agregarLinea("Aerol√≠nea", data.aerolinea);
  const vueloIda = doc.splitTextToSize(`Vuelo de ida: ${data.vuelo_ida}`, 520);
  doc.text(vueloIda, margenX + 10, y); y += vueloIda.length * 14;
  const vueloVuelta = doc.splitTextToSize(`Vuelo de regreso: ${data.vuelo_vuelta}`, 520);
  doc.text(vueloVuelta, margenX + 10, y); y += vueloVuelta.length * 14;

  // Equipaje
  doc.setFont("helvetica", "bold");
  doc.text("Equipaje", margenX, y); y += 14;
  doc.setFont("helvetica", "normal");
  const equipajeLines = doc.splitTextToSize(data.equipaje, 520);
  doc.text(equipajeLines, margenX + 10, y); y += equipajeLines.length * 14;

  // Hotel
  doc.setFont("helvetica", "bold");
  doc.text("Informaci√≥n del Hotel", margenX, y); y += 14;
  doc.setFont("helvetica", "normal");
  agregarLinea("Hotel", data.hotel);
  const hotelLines = doc.splitTextToSize(data.info_hotel, 520);
  doc.text(hotelLines, margenX + 10, y); y += hotelLines.length * 14;

  // Tours Opcionales
  const tablaTours = document.querySelectorAll("#contenedor_tours_opcionales table");
  if (tablaTours.length > 0) {
    if (y >= 680) { doc.addPage(); y = 40; }
    doc.setFont("helvetica", "bold");
    doc.text("Tours Opcionales", margenX, y); y += 10;
    const tableResult = doc.autoTable({
      startY: y + 10,
      html: "#contenedor_tours_opcionales table",
      styles: { fontSize: 10, overflow: "linebreak", cellPadding: 4 },
      headStyles: { fillColor: [2, 83, 90] }
    });
    y = tableResult.lastAutoTable.finalY + 20;
  }

  // Inversi√≥n
  doc.setFont("helvetica", "bold");
  doc.text("Inversi√≥n por Viajero", margenX, y); y += 14;
  doc.setFont("helvetica", "normal");
  agregarLinea("Precio por Adulto", `$${data.precio_adulto}`);
  agregarLinea("Precio por Ni√±o", `$${data.precio_nino}`);
  agregarLinea("Precio por Beb√©", `$${data.precio_bebe}`);
  agregarLinea("Total General", `$${data.total_general}`);
  agregarLinea("Monto de Reserva", `$${data.monto_reserva}`);

  // Pol√≠ticas
  if (y + 200 > 750) { doc.addPage(); y = 40; }
  doc.setFont("helvetica", "bold");
  doc.text("Pol√≠ticas y Condiciones Generales", margenX, y); y += 14;
  doc.setFont("helvetica", "normal");
  const politicasLines = doc.splitTextToSize(data.politicas, 520);
  if (y + politicasLines.length * 14 > 750) {
    doc.addPage();
    y = 40;
  }
  doc.text(politicasLines, margenX + 10, y);

  doc.save(`Cotizacion_${data.destino}.pdf`);
}


window.onload = cargarDatosIniciales;
  </script>

</body>
</html>
