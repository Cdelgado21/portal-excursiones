<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalle de Reserva</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f7f7;
      color: #02535a;
      margin: 0;
      padding: 20px;
    }
    h2 {
      background-color: #02535a;
      color: white;
      padding: 10px;
      border-radius: 8px;
    }
    section {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #02535a;
      color: white;
      padding: 10px 20px;
      border: none;
      margin-top: 10px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>Detalle de Reserva</h2>

<section>
  <label for="codigoCotizacion">Código de Cotización</label>
  <input type="text" id="codigoCotizacion" placeholder="Ej: COT-003-2025">
  <button onclick="cargarDesdeCotizacion()">Cargar Información</button>
  <div id="infoCotizacion"></div>
</section>

<section>
  <h2>Información del Titular</h2>

  <!-- Fila 1 -->
  <div style="display: flex; gap: 20px; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 250px;">
      <label for="nombreTitular">Nombre Completo</label>
      <input type="text" id="nombreTitular" placeholder="Ej. María Fernández Rodríguez">
    </div>

    <div style="flex: 1; min-width: 250px;">
      <label for="cedulaTitular">Cédula o Pasaporte</label>
      <input type="text" id="cedulaTitular" placeholder="Ej. 012345678">
    </div>
  </div>

  <!-- Fila 2 -->
  <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
    <div style="flex: 1; min-width: 250px;">
      <label for="vencimientoPasaporteTitular">Fecha de Vencimiento del Pasaporte</label>
      <input type="date" id="vencimientoPasaporteTitular">
    </div>

<div style="flex: 1; min-width: 250px;">
  <label for="fechaNacimientoTitular">Fecha de Nacimiento</label>
  <div style="display: flex; align-items: center; gap: 10px;">
    <input type="date" id="fechaNacimientoTitular" onchange="mostrarEdadTitular()">
    <span id="edadTitular" style="font-weight: bold; white-space: nowrap;">Edad: -</span>
  </div>
</div>

  <!-- Fila 3 -->
  <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
    <div style="flex: 1; min-width: 250px;">
      <label for="correoTitular">Correo Electrónico</label>
      <input type="email" id="correoTitular" placeholder="Ej. maria@email.com">
    </div>

    <div style="flex: 1; min-width: 250px;">
      <label for="telefonoTitular">Número de Teléfono</label>
      <input type="tel" id="telefonoTitular" placeholder="Ej. 8888-8888">
    </div>
  </div>
</section>


<section>
  <h3>Pasajeros</h3>
  <div id="pasajerosContainer"></div>
  <button onclick="agregarPasajero()">Agregar Pasajero</button>
</section>

<section>

  <h2>Itinerario de Vuelos</h2>
  
<h3>Vuelo de Ida</h3>
<div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
  
  <!-- Aerolínea -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="aerolineaIda">Aerolínea:</label>
    <select id="aerolineaIda" style="min-width: 160px;">
      <option value="">Seleccione una</option>
      <option value="Avianca">Avianca</option>
      <option value="Volaris">Volaris</option>
      <option value="Copa Airlines">Copa Airlines</option>
      <option value="Wingo">Wingo</option>
    </select>
  </div>

  <!-- Fecha -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="fechaIda">Fecha:</label>
    <input type="date" id="fechaIda" style="min-width: 140px;">
  </div>

  <!-- N° de Vuelo -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="vueloIda" style="white-space: nowrap;">N° de Vuelo:</label>
    <input type="text" id="vueloIda" placeholder="Ej. AV637" style="min-width: 130px;">
  </div>

</div>


<label for="infoVueloIda">Información del Vuelo de Ida</label>
<textarea id="infoVueloIda" rows="3" placeholder="Ej. SJO → PTY → MDE, llegada 9:30 AM"></textarea>
<button id="btnAgregarVuelo" style="font-size: 12px; padding: 6px 12px;">➕ Agregar Vuelo Intermedio</button>
  </div>
  <div id="vuelosIntermediosContainer"></div>
  
 <h3>Vuelo de Regreso</h3>
<div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
  
  <!-- Aerolínea -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="aerolineaIda">Aerolínea:</label>
    <select id="aerolineaIda" style="min-width: 160px;">
      <option value="">Seleccione una</option>
      <option value="Avianca">Avianca</option>
      <option value="Volaris">Volaris</option>
      <option value="Copa Airlines">Copa Airlines</option>
      <option value="Wingo">Wingo</option>
    </select>
  </div>

  <!-- Fecha -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="fechaIda">Fecha:</label>
    <input type="date" id="fechaIda" style="min-width: 140px;">
  </div>

  <!-- N° de Vuelo -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="vueloIda" style="white-space: nowrap;">N° de Vuelo:</label>
    <input type="text" id="vueloIda" placeholder="Ej. AV637" style="min-width: 130px;">
  </div>

</div>

<label for="infoVueloRegreso">Información del Vuelo de Regreso</label>
<textarea id="infoVueloRegreso" rows="3" placeholder="Ej. MDE → PTY → SJO, llegada 6:45 PM"></textarea>
</section>

<!-- Script -->
<script>
// const firebaseConfig = { };
// firebase.initializeApp(firebaseConfig);
// const db = firebase.firestore();

  // Cargar cotización
  function cargarDesdeCotizacion() {
    const codigo = document.getElementById('codigoCotizacion').value.trim();
    const contenedor = document.getElementById("infoCotizacion");
    if (!codigo) return alert("Por favor ingresa un código de cotización.");
    contenedor.innerHTML = "Cargando información...";
    db.collection("cotizaciones").doc(codigo).get().then(doc => {
      if (doc.exists) {
        const data = doc.data();
        contenedor.innerHTML = `
          <h3>Resumen</h3>
          <p><strong>Destino:</strong> ${data.destino || 'No disponible'}</p>
          <p><strong>Aerolínea:</strong> ${data.aerolinea || 'No disponible'}</p>
          <p><strong>Hotel:</strong> ${data.hotel || 'No disponible'}</p>
          <p><strong>Incluye:</strong> ${data.incluye || 'No disponible'}</p>
        `;
      } else {
        contenedor.innerHTML = `<p style="color:red;">No se encontró una cotización con ese código.</p>`;
      }
    }).catch(err => {
      console.error(err);
      contenedor.innerHTML = `<p style="color:red;">Error al cargar datos.</p>`;
    });
  }

  // Agregar vuelo intermedio
  let vueloCounter = 1;
  function agregarVueloIntermedio() {
    const container = document.getElementById("vuelosIntermediosContainer");
    const html = `
     <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap; margin-bottom: 10px;">
  
  <!-- Aerolínea -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="aerolineaIda">Aerolínea:</label>
    <select id="aerolineaIda" style="min-width: 160px;">
      <option value="">Seleccione una</option>
      <option value="Avianca">Avianca</option>
      <option value="Volaris">Volaris</option>
      <option value="Copa Airlines">Copa Airlines</option>
      <option value="Wingo">Wingo</option>
    </select>
  </div>

  <!-- Fecha -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="fechaIda">Fecha:</label>
    <input type="date" id="fechaIda" style="min-width: 140px;">
  </div>

  <!-- N° de Vuelo -->
  <div style="display: flex; align-items: center; gap: 6px;">
    <label for="vueloIda" style="white-space: nowrap;">N° de Vuelo:</label>
    <input type="text" id="vueloIda" placeholder="Ej. AV637" style="min-width: 130px;">
  </div>

 </div>
      <label style="display:block; margin-top: 10px;">Información del Vuelo</label>
      <textarea placeholder="Ej. Cartagena → Bogotá, escala de 2h" rows="2" style="width: 100%;"></textarea>
    </section>
  `;
    container.insertAdjacentHTML("beforeend", html);
    vueloCounter++;
  }

  // Pasajeros
  let pasajeros = [];
  function agregarPasajero() {
    const nombre = prompt("Nombre:");
    const pasaporte = prompt("Pasaporte o cédula:");
    const nacimiento = prompt("Fecha de nacimiento (YYYY-MM-DD):");
    const edad = calcularEdad(nacimiento);
    if (nombre && pasaporte && nacimiento) {
      pasajeros.push({ nombre, pasaporte, nacimiento, edad });
      mostrarPasajeros();
    } else {
      alert("Por favor completa todos los datos del pasajero.");
    }
  }

  function mostrarPasajeros() {
    const container = document.getElementById("pasajerosContainer");
    if (pasajeros.length === 0) {
      container.innerHTML = "<p>No hay pasajeros agregados aún.</p>";
      return;
    }

    let html = `
      <table style="width:100%; border-collapse: collapse; margin-top:10px;">
        <thead><tr style="background-color: #02535a; color: white;">
          <th>Nombre</th><th>Pasaporte</th><th>Fecha de Nacimiento</th><th>Eliminar</th></tr>
        </thead><tbody>
    `;
    pasajeros.forEach((p, i) => {
      html += `
        <tr style="background-color:#f9f9f9;">
          <td>${p.nombre}</td><td>${p.pasaporte}</td><td>${p.nacimiento}</td>
          <td><button onclick="eliminarPasajero(${i})" style="background:red; color:white;">X</button></td>
        </tr>`;
    });
    html += "</tbody></table>";
    container.innerHTML = html;
  }

  function eliminarPasajero(index) {
    pasajeros.splice(index, 1);
    mostrarPasajeros();
  }
document.getElementById("fechaNacimientoTitular").addEventListener("change", function () {
  const fecha = this.value;
  const edad = calcularEdad(fecha);
  document.getElementById("edadTitular").textContent = `Edad: ${edad} años`;
});

function calcularEdad(fechaNacimiento) {
  const hoy = new Date();
  const nacimiento = new Date(fechaNacimiento);
  let edad = hoy.getFullYear() - nacimiento.getFullYear();
  const mes = hoy.getMonth() - nacimiento.getMonth();
  if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
    edad--;
  }
  return edad;
}
  // Activar botón al cargar
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("btnAgregarVuelo").addEventListener("click", agregarVueloIntermedio);
  });
</script>

</body>
</html>
